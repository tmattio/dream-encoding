<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dream_encoding (dream-encoding.Dream_encoding)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">dream-encoding</a> &#x00BB; Dream_encoding</nav><h1>Module <code>Dream_encoding</code></h1><p>Encoding primitives for Dream.</p><p>The main use case for this library is to compress the response body of a given list of endpoints. To do this, you can simply add <code>Dream_encoding.compress</code> to your list of middlewares:</p><pre><code class="ml">let () =
  Dream.run
  @@ Dream.logger
  @@ Dream_encoding.compress
  @@ Dream.router [ Dream.get &quot;/&quot; (fun _ -&gt; Dream.html &quot;Hello World!&quot;) ]
  @@ Dream.not_found</code></pre><p>For more advanced use cases, some utility functions are also exposed. In particular, functions to retrieve the <code>Content-Encoding</code> and <code>Accept-Encoding</code> headers (respectively, <code>content_encoding</code> and <code>accept_encoding</code>), as well as <code>with_encoded_body</code>, a function to compress the body of a response.</p><p>As of now, the supported encoding directives are <code>deflate</code> and <code>gzip</code>. More directive will be supported when their support land in <code>decompress</code>, the underlying compression library used by Dream_encoding.</p></header><dl><dt class="spec value" id="val-compress"><a href="#val-compress" class="anchor"></a><code><span class="keyword">val</span> compress : Dream.middleware</code></dt><dd><p>Middleware that reads the <code>Accept-Encoding</code> header of the request and compresses the responses with the preferred supported algorithm.</p></dd></dl><dl><dt class="spec value" id="val-decompress"><a href="#val-decompress" class="anchor"></a><code><span class="keyword">val</span> decompress : Dream.middleware</code></dt><dd><p>Middleware that reads the <code>Content-Encoding</code> of the request and decompresses the body if all of the directives of the header are supported.</p><p>If one or more of the directive is not supported, an HTTP response <code>415 Unsupported Media Type</code> is returned to the client.</p><p>Note that although HTTP supports encoding requests, it is rarely used in practice. See <code>compress</code> to for a middleware that compresses the responses instead.</p></dd></dl><dl><dt class="spec value" id="val-with_encoded_body"><a href="#val-with_encoded_body" class="anchor"></a><code><span class="keyword">val</span> with_encoded_body : <span>?&#8288;algorithm:<span>[ `Deflate <span>| `Gzip</span> ]</span></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> Dream.response <span>&#45;&gt;</span> Dream.response</code></dt><dd><p><code>with_encoded_body ?algorithm body response</code> replaces the body of the response with <code>body</code> compressed with <code>algorithm</code> and adds the corresponding <code>Content-Encoding</code> header.</p><p><code>algorithm</code> defaults to <code>`Deflate</code>.</p></dd></dl><dl><dt class="spec value" id="val-accepted_encodings"><a href="#val-accepted_encodings" class="anchor"></a><code><span class="keyword">val</span> accepted_encodings : <span><span class="type-var">'a</span> Dream.message</span> <span>&#45;&gt;</span> <span><span><span>[ `Gzip <span>| `Compress</span> <span>| `Deflate</span> <span>| `Identity</span> <span>| `Any</span> <span><span>| `Unknown</span> of string</span> ]</span> list</span> option</span></code></dt><dd><p>Retrieve the list of accepted encoding directives from the <code>Accept-Encoding</code> header, ordered by quality weight in decreasing order.</p><p>If the request does not have an <code>Accept-Encoding</code> header, this returns <code>None</code>.</p></dd></dl><dl><dt class="spec value" id="val-accepted_encodings_with_weights"><a href="#val-accepted_encodings_with_weights" class="anchor"></a><code><span class="keyword">val</span> accepted_encodings_with_weights : <span><span class="type-var">'a</span> Dream.message</span> <span>&#45;&gt;</span> <span><span><span>(<span>[ `Gzip <span>| `Compress</span> <span>| `Deflate</span> <span>| `Identity</span> <span>| `Any</span> <span><span>| `Unknown</span> of string</span> ]</span> * int)</span> list</span> option</span></code></dt><dd><p>Same as <code>accepted_encoding</code>, but returns the quality weights associated to the encoding directive.</p></dd></dl><dl><dt class="spec value" id="val-content_encodings"><a href="#val-content_encodings" class="anchor"></a><code><span class="keyword">val</span> content_encodings : <span><span class="type-var">'a</span> Dream.message</span> <span>&#45;&gt;</span> <span><span><span>[ `Gzip <span>| `Compress</span> <span>| `Deflate</span> <span>| `Identity</span> <span>| `Any</span> <span><span>| `Unknown</span> of string</span> ]</span> list</span> option</span></code></dt><dd><p>Retrieve the list of content encoding directives from the <code>Content-Encoding</code> header.</p><p>If the request does not have an <code>Content-Encoding</code> header, this returns <code>None</code>.</p></dd></dl><dl><dt class="spec value" id="val-preferred_content_encoding"><a href="#val-preferred_content_encoding" class="anchor"></a><code><span class="keyword">val</span> preferred_content_encoding : <span><span class="type-var">'a</span> Dream.message</span> <span>&#45;&gt;</span> <span><span>[ `Deflate <span>| `Gzip</span> ]</span> option</span></code></dt><dd><p>Retrieve preferred encoding directive from the <code>Accept-Encoding</code>.</p><p>The preferred encoding directive is the first supported algorithm in the list of accepted directives sorted by quality weight.</p><p>If <code>*</code> is given as the preferred encoding, <code>`Gzip</code> is returned. This is to be on par with the behavior of <code>compress</code>.</p><p>If no algorithm is supported, or if the request does not have an <code>Accept-Encoding</code> header, this returns <code>None</code>.</p></dd></dl></div></body></html>